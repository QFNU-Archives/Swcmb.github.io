---
title: C++程序设计第6章大程序
date: 2024-07-07 11:22:00
tags: 曲园
category: CodeWorld
---

这段代码中包含了许多面向对象编程和C++语言的知识点，以下是详细的解释：

1. **类的定义和继承**：
   - `Shape`是一个基类，定义了所有形状都应该具有的基本属性和行为。它包含虚函数`area()`和`volume()`，以及纯虚函数`shapeName()`。虚函数使得派生类可以重写这些函数，以提供具体的实现，而纯虚函数则要求任何直接继承自`Shape`的派生类都必须提供`shapeName()`的具体实现。
   - `Point`, `Circle`, 和 `Cylinder`都是从`Shape`类派生出来的子类，分别表示点、圆和圆柱体。这些类通过公有继承(`public Shape`)来继承`Shape`类的属性和方法。

2. **构造函数**：
   - 每个类都有构造函数来初始化其成员变量。例如，`Point`类有一个带有两个参数的构造函数，用于初始化点的坐标。`Circle`类有一个带有三个参数的构造函数，用于初始化圆心坐标和半径。

3. **虚函数**：
   - 在基类`Shape`中定义了虚函数`area()`和`volume()`，这些函数在派生类中被重写。这样做的目的是允许通过基类指针或引用调用派生类的相应函数，实现多态。例如，`Circle`类和`Cylinder`类都重写了`area()`函数来计算圆的面积和圆柱的表面积。

4. **纯虚函数**：
   - `Shape`类中的`shapeName()`是一个纯虚函数，这意味着`Shape`类是一个抽象基类，不能直接实例化。派生类必须提供`shapeName()`的具体实现。

5. **操作符重载**：
   - `<<`运算符被重载，以便可以直接将`Point`、`Circle`和`Cylinder`对象插入到输出流中。这使得打印对象的状态变得方便。

6. **友元函数**：
   - `operator<<`函数被声明为`Shape`及其派生类的友元函数，这样它们就可以访问类的私有和保护成员。

7. **动态内存分配**：
   - 虽然代码没有直接显示使用`new`和`delete`，但在创建对象时（如`Circle circle(2.4,1.2,5.6);`）可能会涉及到动态内存分配，这取决于编译器和运行时环境。

8. **多态和指向基类的指针**：
   - 在`main()`函数中，使用`Shape* pt;`声明了一个指向`Shape`类型的指针。这个指针可以用来指向任何`Shape`的派生类对象。通过该指针调用的成员函数（如`area()`和`volume()`）将根据指针实际指向的对象类型来决定调用哪个版本的函数，这是多态的典型应用。

9. **对象的动态类型识别**：
   - 使用基类指针`pt`可以指向不同的派生类对象，并且在运行时确定对象的实际类型，然后调用相应的方法。例如，当`pt`指向`Circle`对象时，调用`pt->area()`会执行`Circle`类的`area()`方法。

10. **对象生命周期**：
    - 当对象不再需要时，应该适当地销毁对象并释放资源，防止内存泄漏。尽管在这段代码中没有显式调用析构函数，但当对象的生命周期结束或使用`delete`释放动态分配的内存时，会自动调用析构函数。

11. **作用域**：
    - 类的成员变量和成员函数默认是私有的，只能由类的成员函数访问。使用`protected`关键字可以让派生类访问基类的某些成员，而`public`关键字则让所有函数和外部代码都能访问。

总的来说，这段代码展示了如何使用C++来模拟现实世界中的对象以及它们之间的关系，并且演示了如何利用面向对象编程的特性来简化代码，提高代码的可维护性和可扩展性。



```c++
#include<iostream>
using namespace std;

// 定义一个抽象基类Shape，包含虚函数area()和volume()以及纯虚函数shapeName()
class Shape{
public:
	virtual float area() const {return 0.0;} // 计算面积的虚函数，默认返回0.0
	virtual float volume() const {return 0.0;} // 计算体积的虚函数，默认返回0.0
	virtual void shapeName() const=0; // 纯虚函数，用于输出形状名称
};

// Point类继承自Shape类，表示二维平面上的点
class Point:public Shape{
public:
	Point(float=0,float=0); // 构造函数，初始化点的坐标
	void setPoint(float,float); // 设置点的坐标
	float getX() const {return x;} // 获取x坐标
	float getY() const {return y;} // 获取y坐标
	virtual void shapeName() const {cout<<"Point:";} // 输出形状名称为"Point"
	friend ostream & operator<<(ostream &,const Point &); // 重载输出运算符，方便输出点的信息
protected:
	float x,y; // 点的坐标
};
Point::Point(float a,float b)
{x=a;y=b;} // 构造函数实现
void Point::setPoint(float a,float b)
{x=a;y=b;} // 设置点的坐标
ostream & operator<<(ostream &output,const Point &p) // 重载输出运算符实现
{
	output<<"["<<p.x<<","<<p.y<<"]";
	return output;
}

// Circle类继承自Point类，表示二维平面上的圆
class Circle:public Point {
public:
	Circle(float x=0,float y=0,float r=0); // 构造函数，初始化圆心坐标和半径
	void setRadius(float r); // 设置半径
	float getRadius() const; // 获取半径
	virtual float area() const; // 计算面积的虚函数
	virtual void shapeName() const {cout<<"Circle:";}; // 输出形状名称为"Circle"
	friend ostream &operator<<(ostream &,const Circle &); // 重载输出运算符，方便输出圆的信息
protected:
	float radius; // 圆的半径
};
Circle::Circle(float a,float b,float r):Point(a,b),radius(r){} // 构造函数实现
void Circle::setRadius(float r){radius=r;} // 设置半径
float Circle::getRadius() const {return radius;} // 获取半径
float Circle::area() const {return 3.1415926*radius*radius;} // 计算面积的实现
ostream &operator<<(ostream &output,const Circle &c) // 重载输出运算符实现
{
	output<<"["<<c.x<<","<<c.y<<"],r="<<c.radius;
	return output;
}

// Cylinder类继承自Circle类，表示三维空间中的圆柱体
class Cylinder:public Circle{
public:
	Cylinder(float x=0,float y=0,float r=0,float h=0); // 构造函数，初始化底面圆心坐标、半径和高度
	void setHeight(float); // 设置高度
	virtual float area() const; // 计算表面积的虚函数
	virtual float volume() const; // 计算体积的虚函数
	virtual void shapeName() const {cout<<"Cylinder:";} // 输出形状名称为"Cylinder"
	friend ostream& operator<<(ostream&,const Cylinder&); // 重载输出运算符，方便输出圆柱体的信息
protected:
	float height; // 圆柱体的高
};
Cylinder::Cylinder(float a,float b,float r,float h):Circle(a,b,r),height(h){} // 构造函数实现
float Cylinder::area() const {return 2*Circle::area()+2*3.1415926*radius*height;} // 计算表面积的实现
float Cylinder::volume() const {return Circle::area()*height;} // 计算体积的实现
ostream &operator<<(ostream &output,const Cylinder& cy) // 重载输出运算符实现
{
	output<<"["<<cy.x<<","<<cy.y<<"],r="<<cy.radius<<",h="<<cy.height;
	return output;
}

int main()
{
	Point point(3.2,4.5); // 创建一个点对象
	Circle circle(2.4,1.2,5.6); // 创建一个圆对象
	Cylinder cylinder(3.5,6.4,5.2,10.5); // 创建一个圆柱体对象
	point.shapeName(); // 输出点的形状名称
	cout<<point<<endl; // 输出点的坐标信息
	
	circle.shapeName(); // 输出圆的形状名称
	cout<<circle<<endl; // 输出圆的信息
	
	Shape *pt; // 定义一个指向Shape类的指针
	pt=&point; // 让指针指向点对象
	pt->shapeName(); // 输出点的形状名称
	cout<<"x="<<point.getX()<<",y="<<point.getY()<<"\narea="<<pt->area()<<"\nvolume="<<pt->volume()<<"\n\n"; // 输出点的坐标、面积和体积
	
	pt=&circle; // 让指针指向圆对象
	pt->shapeName(); // 输出圆的形状名称
	cout<<"x="<<circle.getX()<<",y="<<circle.getY()<<"\narea="<<pt->area()<<"\nvolume="<<pt->volume()<<"\n\n"; // 输出圆的信息
	
	pt=&cylinder; // 让指针指向圆柱体对象
	pt->shapeName(); // 输出圆柱体的形状名称
	cout<<"x="<<cylinder.getX()<<",y="<<cylinder.getY()<<"\narea="<<pt->area()<<"\nvolume="<<pt->volume()<<"\n\n"; // 输出圆柱体的信息
	
	return 0;
}
```

程序中定义了三个类：Shape、Point、Circle和Cylinder。其中，Shape是一个抽象基类，它定义了一些虚函数和一个纯虚函数shapeName()。Point类继承自Shape类，表示二维平面上的点，并实现了一些成员函数。Circle类继承自Point类，表示二维平面上的圆，并实现了一些成员函数。Cylinder类继承自Circle类，表示三维空间中的圆柱体，并实现了一些成员函数。

以下是各个成员在各类的范围内的访问属性：

1. Shape类的成员：
   - area()：public virtual，可以在派生类中被重写。
   - volume()：public virtual，可以在派生类中被重写。
   - shapeName()：public pure virtual，必须在派生类中实现。

   > [!NOTE]
   >
   > shapeName()是一个纯虚函数，它在Shape基类中被声明但没有实现。纯虚函数是一种在基类中声明但不提供实现的虚函数，它的目的是让派生类必须重写这个函数并提供具体的实现。
   >
   > 在这个例子中，Shape类是一个抽象基类，它定义了一个接口，即shapeName()，但并没有给出具体的行为。这是因为不同的形状有不同的名称，例如点、圆和圆柱体都有各自不同的名称。因此，为了让每个派生类能够输出正确的形状名称，必须在每个派生类中实现shapeName()函数。
   >
   > 如果一个类包含至少一个纯虚函数，那么这个类就被称为抽象类，不能直接实例化。只有当所有的纯虚函数都被实现时，派生类才能被实例化。在这个例子中，Point、Circle和Cylinder都是Shape的具体实现，它们分别实现了shapeName()函数来输出各自的形状名称。
   
   
   
2. Point类的成员：
   - Point(float, float)：public，构造函数。
   - setPoint(float, float)：public，设置点的坐标。
   - getX()：public，获取x坐标。
   - getY()：public，获取y坐标。
   - shapeName()：public virtual，输出形状名称为"Point"。
   - operator<<：friend，重载输出运算符。
   - x, y：protected，点的坐标。

3. Circle类的成员：
   - Circle(float, float, float)：public，构造函数。
   - setRadius(float)：public，设置半径。
   - getRadius()：public，获取半径。
   - area()：public virtual，计算面积。
   - shapeName()：public virtual，输出形状名称为"Circle"。
   - operator<<：friend，重载输出运算符。
   - radius：protected，圆的半径。

4. Cylinder类的成员：
   - Cylinder(float, float, float, float)：public，构造函数。
   - setHeight(float)：public，设置高度。
   - area()：public virtual，计算表面积。
   - volume()：public virtual，计算体积。
   - shapeName()：public virtual，输出形状名称为"Cylinder"。
   - operator<<：friend，重载输出运算符。
   - height：protected，圆柱体的高。

程序执行过程中，首先创建了一个Point对象、一个Circle对象和一个Cylinder对象。然后分别调用它们的shapeName()函数输出形状名称，接着使用cout输出它们的信息。接下来，定义了一个指向Shape类的指针pt，并将它分别指向point、circle和cylinder对象，然后通过这个指针调用shapeName()函数输出形状名称，并通过getX(), getY(), getRadius(), area(), volume()等函数输出相关信息。最后，main函数返回0，程序结束。
